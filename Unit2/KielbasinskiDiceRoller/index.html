<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kielbasinski Dice Roller</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body:has(.container) {
            height: 100vh;
            font-family: "Inter", sans-serif;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            align-items: center;
            justify-content: center;
            gap: 3em;
            overflow: hidden;
            position: relative;
            background: linear-gradient(salmon, pink)
        }

        .container>* {
            z-index: 1;
        }

        [data-theme="custom"] {
            --matchBg: linear-gradient(to bottom right, #0f172a, #4f453f) !important;
        }

        @media (max-width: 1024px) {
            .component-header h2 {
                font-size: 1.5em;
            }

            .component-header button {
                --wh: 2em;
            }
        }

        .themes ul {
            display: flex;
            gap: 0.8em;
            position: relative;
            --wh: 1.2em;
        }

        .themes ul::before {
            content: "";
            width: var(--wh);
            height: var(--wh);
            transform: scale(1.1);
            box-shadow: 0px 0px 0px 2px #fff;
            position: absolute;
            inset: 0;
            left: var(--posX, 0);
            border-radius: 50%;
            transition: 0.3s;
            transition-timing-function: (0.23, 1, 0.32, 1.2);
        }

        .themes ul li {
            width: var(--wh);
            height: var(--wh);
            border-radius: 50%;
            list-style: none;
            cursor: pointer;
            z-index: 1;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
        }

        .container {
            &[data-theme="dark"] {
                --diceEdgeClr: #22262f;
                --faceClr: #1e2022;
                --faceBeatClr: linear-gradient(to bottom right, #e2e8f0, #64748b);
                --liClr: rgb(212 212 216);
            }

            &[data-theme="light"] {
                --diceEdgeClr: #f3f3f3;
                --faceClr: #fff;
                --faceBeatClr: linear-gradient(to bottom right,
                        rgb(93, 93, 95),
                        rgb(30, 32, 34));
                --liClr: rgb(9 9 11);
            }

            &[data-theme="custom"] {
                --diceEdgeClr: #c81a1a;
                --faceClr: #b91c1c;
                --faceBeatClr: linear-gradient(to bottom right, #fff, #e0e0e0);
                --liClr: rgb(212 212 216);
                --matchBg: tomato;
            }
        }


        .dice-container {
            display: flex;
            height: 15rem;
            width: 15rem;
            align-items: center;
            justify-content: center;
            perspective: 600px;
        }

        .dice-container::after {
            content: "";
            width: 7em;
            height: 7em;
            background: rgb(30 32 34 / 0.25);
            position: absolute;
            bottom: 0;
            border-radius: 50%;
            transform: rotateX(85deg) translateZ(-50px);
            filter: blur(40px);
        }

        .dice {
            --wh: 80px;
            width: var(--wh);
            height: var(--wh);
            position: relative;
            transition: 1s;
            transition-timing-function: cubic-bezier(0.23, 1, 0.32, 1.2);
            background: var(--diceEdgeClr);
            transform-style: preserve-3d;
        }

        .dice .face {
            position: absolute;
            height: 100%;
            width: 100%;
            border-radius: 1rem;
            padding: 0.75rem;
            background: var(--faceClr);
            border: 2px solid var(--diceEdgeClr);
            transform-style: preserve-3d;
            display: grid;
            place-items: center;

            span {
                --wh: 0.8rem;
                width: var(--wh);
                height: var(--wh);
                background: var(--faceBeatClr);
                border-radius: 50%;
                box-shadow: inset 0px 0px 4px rgba(0, 0, 0, 0.3);
            }

            & span:nth-of-type(1) {
                grid-area: a;
            }

            & span:nth-of-type(2) {
                grid-area: b;
            }

            & span:nth-of-type(3) {
                grid-area: c;
            }

            & span:nth-of-type(4) {
                grid-area: d;
            }

            & span:nth-of-type(5) {
                grid-area: e;
            }

            & span:nth-of-type(6) {
                grid-area: f;
            }

            &::before {
                content: "";
                width: 100%;
                height: 100%;
                position: absolute;
                background: var(--diceEdgeClr);
                border-radius: inherit;
                transform: translateZ(-2px) scale(1.08);
            }
        }

        .front {
            transform: translateZ(calc(var(--wh) / 2 + 1px));
            grid-template-areas:
                ". . ."
                ". a ."
                ". . .";
        }

        .top {
            transform: rotateX(90deg) translateZ(calc(var(--wh) / 2 + 1px));
            grid-template-areas:
                "a . ."
                ". . ."
                ". . b";
        }

        .left {
            transform: rotateY(-90deg) translateZ(calc(var(--wh) / 2 + 1px));
            grid-template-areas:
                "a . ."
                ". b ."
                ". . c";
        }

        .right {
            transform: rotateY(90deg) translateZ(calc(var(--wh) / 2 + 1px));
            grid-template-areas:
                "a . b"
                ". . ."
                "c . d";
        }

        .bottom {
            transform: rotateX(-90deg) translateZ(calc(var(--wh) / 2 + 1px));
            grid-template-areas:
                "a . b"
                ". c ."
                "d . e";
        }

        .back {
            transform: rotateY(180deg) translateZ(calc(var(--wh) / 2 + 1px));
            grid-template-areas:
                "a . b"
                "c . d"
                "e . f";
        }

        .dice[data-face="1"] {
            transform: translateZ(calc(var(--wh) / 2)) rotateX(20deg) rotateY(20deg);
        }

        .dice[data-face="2"] {
            transform: translateZ(calc(var(--wh) / 2)) rotateX(-70deg) rotateZ(20deg);
        }

        .dice[data-face="3"] {
            transform: translateZ(calc(var(--wh) / 2)) rotateY(70deg) rotateZ(25deg);
        }

        .dice[data-face="4"] {
            transform: translateZ(calc(var(--wh) / 2)) rotateY(-107deg) rotateZ(20deg);
        }

        .dice[data-face="5"] {
            transform: translateZ(calc(var(--wh) / 2)) rotateX(110deg) rotateZ(-20deg);
        }

        .dice[data-face="6"] {
            transform: translateZ(calc(var(--wh) / 2)) rotateY(158deg) rotateX(-20deg);
        }
    </style>
</head>

<body>
    <div class="container" data-theme='dark'>
        <div class="dice-container">
            <div id="dice" class="dice" data-face="1">
                <div class="face front"><span></span></div>
                <div class="face top"><span></span><span></span></div>
                <div class="face left"><span></span><span></span><span></span></div>
                <div class="face right"><span></span><span></span><span></span><span></span></div>
                <div class="face bottom"><span></span><span></span><span></span><span></span><span></span></div>
                <div class="face back"><span></span><span></span><span></span><span></span><span></span><span></span>
                </div>
            </div>
        </div>
        <div class="themes"></div>
    </div>
</body>
<script>
    const themes = [
        { theme: "dark", priClr: "#1e2022", secClr: "#22262f" },
        { theme: "light", priClr: "#fff", secClr: "#f3f3f3" },
    ];

    let themeIndex = 0;

    const themesDOM = document.querySelector(".themes");

    const themeEvent = (targetEle) => {
        const targetElement = targetEle.target;

        const targetEleIndex = Array.from(
            document.querySelectorAll(".themes ul li")
        ).indexOf(targetElement);

        const switchThemeTo = targetElement.getAttribute("data-theme");

        const parentElement = targetElement.closest("ul");

        const { x: parentX } = parentElement.getBoundingClientRect();
        const { x: targetX } = targetElement.getBoundingClientRect();

        const fromX = `${targetX - parentX}px`;

        parentElement.style.setProperty("--posX", fromX);

        const containerEle = document.querySelector(".container");

        containerEle.setAttribute("data-theme", switchThemeTo);

        const { priClr, secClr } = themes[targetEleIndex];

        containerEle.style.setProperty(
            "--matchBg",
            `linear-gradient(to bottom right, ${priClr}, ${secClr})`
        );
    };

    const renderThemes = () => {
        const ulEle = document.createElement("ul");

        themes.forEach((themeData) => {
            const { theme, priClr, secClr } = themeData;

            const liEle = document.createElement("li");

            liEle.style.background = `linear-gradient(to bottom right, ${priClr} 50%, ${secClr} 50%)`;

            liEle.setAttribute("data-theme", theme);

            liEle.addEventListener("click", themeEvent);

            ulEle.appendChild(liEle);
        });

        themesDOM.appendChild(ulEle);
    };

    renderThemes();

    let currentFace = 1;

    const getRandomFace = () => {
        let newFace;

        do {
            newFace = Math.floor(Math.random() * 6) + 1;
        } while (newFace === currentFace);

        return newFace;
    };

    // rolling animation: spin a few times then pick a new face
    const diceEl = document.getElementById('dice');
    let isRolling = false;

    const rollDice = (el) => {
        if (isRolling) return;
        isRolling = true;

        const totalSpins = 6; // how many full rotations
        const duration = 1000 + Math.random() * 800; // ms
        const start = performance.now();

        // starting rotation (read current computed transform if any)
        const from = { x: 0, y: 0, z: 0 };

        function animate(now) {
            const t = Math.min(1, (now - start) / duration);
            // ease out
            const ease = 1 - Math.pow(1 - t, 3);

            const angle = ease * totalSpins * 360;

            // apply combined rotation while keeping the final transform handled by data-face
            el.style.transform = `translateZ(calc(var(--wh) / 2)) rotateX(${angle}deg) rotateY(${angle / 2}deg)`;

            if (t < 1) {
                requestAnimationFrame(animate);
            } else {
                // choose final face (different from currentFace)
                const finalFace = getRandomFace();
                el.setAttribute('data-face', finalFace);
                currentFace = parseInt(el.getAttribute('data-face'));
                // clear inline transform so CSS data-face rules take over
                el.style.transform = '';
                isRolling = false;
            }
        }

        requestAnimationFrame(animate);
    };

    // attach click handler
    if (diceEl) {
        diceEl.addEventListener('click', () => rollDice(diceEl));
    }
</script>

</html>